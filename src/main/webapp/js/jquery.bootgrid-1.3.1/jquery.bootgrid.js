;(function($,window,undefined){"use strict";var namespace=".rs.jquery.bootgrid";function appendRow(row){var that=this;function exists(item){return that.identifier&&item[that.identifier]===row[that.identifier]}if(!this.rows.contains(exists)){this.rows.push(row);return true}return false}function findFooterAndHeaderItems(selector){var footer=(this.footer)?this.footer.find(selector):$(),header=(this.header)?this.header.find(selector):$();return $.merge(footer,header)}function getParams(context){return(context)?$.extend({},this.cachedParams,{ctx:context}):this.cachedParams}function getRequest(){var request={current:this.current,rowCount:this.rowCount,sort:this.sortDictionary,searchPhrase:this.searchPhrase},post=this.options.post;post=($.isFunction(post))?post():post;return this.options.requestHandler($.extend(true,request,post))}function getCssSelector(css){return"."+$.trim(css).replace(/\s+/gm,".")}function getUrl(){var url=this.options.url;return($.isFunction(url))?url():url}function init(){this.element.trigger("initialize"+namespace);loadColumns.call(this);this.selection=this.options.selection&&this.identifier!=null;loadRows.call(this);prepareTable.call(this);renderTableHeader.call(this);renderSearchField.call(this);renderActions.call(this);loadData.call(this);this.element.trigger("initialized"+namespace)}function highlightAppendedRows(rows){if(this.options.highlightRows){}}function isVisible(column){return column.visible}function loadColumns(){var that=this,firstHeadRow=this.element.find("thead > tr").first(),sorted=false;firstHeadRow.children().each(function(){var $this=$(this),data=$this.data(),column={id:data.columnId,identifier:that.identifier==null&&data.identifier||false,converter:that.options.converters[data.converter||data.type]||that.options.converters["string"],text:$this.text(),align:data.align||"left",headerAlign:data.headerAlign||"left",cssClass:data.cssClass||"",headerCssClass:data.headerCssClass||"",formatter:that.options.formatters[data.formatter]||null,order:(!sorted&&(data.order==="asc"||data.order==="desc"))?data.order:null,searchable:!(data.searchable===false),sortable:!(data.sortable===false),visible:!(data.visible===false),visibleInSelection:!(data.visibleInSelection===false),width:($.isNumeric(data.width))?data.width+"px":(typeof(data.width)==="string")?data.width:null};that.columns.push(column);if(column.order!=null){that.sortDictionary[column.id]=column.order}if(column.identifier){that.identifier=column.id;that.converter=column.converter}if(!that.options.multiSort&&column.order!==null){sorted=true}})}function loadData(){var that=this;this.element._bgBusyAria(true).trigger("load"+namespace);showLoading.call(this);function containsPhrase(row){var column,searchPattern=new RegExp(that.searchPhrase,(that.options.caseSensitive)?"g":"gi");console.log("row---------------------"+JSON.stringify(row));for(var i=0;i<that.columns.length;i++){column=that.columns[i];if(column.searchable&&column.visible&&column.converter.to(row[column.id]).search(searchPattern)>-1){return true}}return false}function update(rows,total){that.currentRows=rows;setTotals.call(that,total);if(!that.options.keepSelection){that.selectedRows=[]}renderRows.call(that,rows);renderInfos.call(that);renderPagination.call(that);that.element._bgBusyAria(false).trigger("loaded"+namespace)}if(this.options.ajax){var request=getRequest.call(this),url=getUrl.call(this);if(url==null||typeof url!=="string"||url.length===0){throw new Error("Url setting must be a none empty string or a function that returns one.");}if(this.xqr){this.xqr.abort()}var settings={url:url,data:request,success:function(response){that.xqr=null;if(typeof(response)==="string"){response=$.parseJSON(response)}response=that.options.responseHandler(response);that.current=response.current;update(response.rows,response.total)},error:function(jqXHR,textStatus,errorThrown){that.xqr=null;if(textStatus!=="abort"){renderNoResultsRow.call(that);that.element._bgBusyAria(false).trigger("loaded"+namespace)}}};settings=$.extend(this.options.ajaxSettings,settings);this.xqr=$.ajax(settings)}else{var rows=(this.searchPhrase.length>0)?this.rows.where(containsPhrase):this.rows,total=rows.length;if(this.rowCount!==-1){rows=rows.page(this.current,this.rowCount)}window.setTimeout(function(){update(rows,total)},10)}}function loadRows(){if(!this.options.ajax){var that=this,rows=this.element.find("tbody > tr");rows.each(function(){var $this=$(this),cells=$this.children("td"),row={};$.each(that.columns,function(i,column){row[column.id]=column.converter.from(cells.eq(i).text())});appendRow.call(that,row)});setTotals.call(this,this.rows.length);sortRows.call(this)}}function setTotals(total){this.total=total;this.totalPages=(this.rowCount===-1)?1:Math.ceil(this.total/this.rowCount)}function prepareTable(){var tpl=this.options.templates,wrapper=(this.element.parent().hasClass(this.options.css.responsiveTable))?this.element.parent():this.element;this.element.addClass(this.options.css.table);if(this.element.children("tbody").length===0){this.element.append(tpl.body)}if(this.options.navigation&1){this.header=$(tpl.header.resolve(getParams.call(this,{id:this.element._bgId()+"-header"})));wrapper.before(this.header)}if(this.options.navigation&2){this.footer=$(tpl.footer.resolve(getParams.call(this,{id:this.element._bgId()+"-footer"})));wrapper.after(this.footer)}}function renderActions(){if(this.options.navigation!==0){var css=this.options.css,selector=getCssSelector(css.actions),actionItems=findFooterAndHeaderItems.call(this,selector);if(actionItems.length>0){var that=this,tpl=this.options.templates,actions=$(tpl.actions.resolve(getParams.call(this)));if(this.options.ajax){var refreshIcon=tpl.icon.resolve(getParams.call(this,{iconCss:css.iconRefresh})),refresh=$(tpl.actionButton.resolve(getParams.call(this,{content:refreshIcon,text:this.options.labels.refresh}))).on("click"+namespace,function(e){e.stopPropagation();that.current=1;loadData.call(that)});actions.append(refresh)}renderRowCountSelection.call(this,actions);renderColumnSelection.call(this,actions);replacePlaceHolder.call(this,actionItems,actions)}}}function renderColumnSelection(actions){if(this.options.columnSelection&&this.columns.length>1){var that=this,css=this.options.css,tpl=this.options.templates,icon=tpl.icon.resolve(getParams.call(this,{iconCss:css.iconColumns})),dropDown=$(tpl.actionDropDown.resolve(getParams.call(this,{content:icon}))),selector=getCssSelector(css.dropDownItem),checkboxSelector=getCssSelector(css.dropDownItemCheckbox),itemsSelector=getCssSelector(css.dropDownMenuItems);$.each(this.columns,function(i,column){if(column.visibleInSelection){var item=$(tpl.actionDropDownCheckboxItem.resolve(getParams.call(that,{name:column.id,label:column.text,checked:column.visible}))).on("click"+namespace,selector,function(e){e.stopPropagation();var $this=$(this),checkbox=$this.find(checkboxSelector);if(!checkbox.prop("disabled")){column.visible=checkbox.prop("checked");var enable=that.columns.where(isVisible).length>1;$this.parents(itemsSelector).find(selector+":has("+checkboxSelector+":checked)")._bgEnableAria(enable).find(checkboxSelector)._bgEnableField(enable);that.element.find("tbody").empty();renderTableHeader.call(that);loadData.call(that)}});dropDown.find(getCssSelector(css.dropDownMenuItems)).append(item)}});actions.append(dropDown)}}function renderInfos(){if(this.options.navigation!==0){var selector=getCssSelector(this.options.css.infos),infoItems=findFooterAndHeaderItems.call(this,selector);if(infoItems.length>0){var end=(this.current*this.rowCount),infos=$(this.options.templates.infos.resolve(getParams.call(this,{end:(this.total===0||end===-1||end>this.total)?this.total:end,start:(this.total===0)?0:(end-this.rowCount+1),total:this.total})));replacePlaceHolder.call(this,infoItems,infos)}}}function renderNoResultsRow(){var tbody=this.element.children("tbody").first(),tpl=this.options.templates,count=this.columns.where(isVisible).length;if(this.selection){count=count+1}tbody.html(tpl.noResults.resolve(getParams.call(this,{columns:count})))}function renderPagination(){if(this.options.navigation!==0){var selector=getCssSelector(this.options.css.pagination),paginationItems=findFooterAndHeaderItems.call(this,selector)._bgShowAria(this.rowCount!==-1);if(this.rowCount!==-1&&paginationItems.length>0){var tpl=this.options.templates,current=this.current,totalPages=this.totalPages,pagination=$(tpl.pagination.resolve(getParams.call(this))),offsetRight=totalPages-current,offsetLeft=(this.options.padding-current)*-1,startWith=((offsetRight>=this.options.padding)?Math.max(offsetLeft,1):Math.max((offsetLeft-this.options.padding+offsetRight),1)),maxCount=this.options.padding*2+1,count=(totalPages>=maxCount)?maxCount:totalPages;renderPaginationItem.call(this,pagination,"first","&laquo;","first")._bgEnableAria(current>1);renderPaginationItem.call(this,pagination,"prev","&lt;","prev")._bgEnableAria(current>1);for(var i=0;i<count;i++){var pos=i+startWith;renderPaginationItem.call(this,pagination,pos,pos,"page-"+pos)._bgEnableAria()._bgSelectAria(pos===current)}if(count===0){renderPaginationItem.call(this,pagination,1,1,"page-"+1)._bgEnableAria(false)._bgSelectAria()}renderPaginationItem.call(this,pagination,"next","&gt;","next")._bgEnableAria(totalPages>current);renderPaginationItem.call(this,pagination,"last","&raquo;","last")._bgEnableAria(totalPages>current);replacePlaceHolder.call(this,paginationItems,pagination)}}}function renderPaginationItem(list,page,text,markerCss){var that=this,tpl=this.options.templates,css=this.options.css,values=getParams.call(this,{css:markerCss,text:text,page:page}),item=$(tpl.paginationItem.resolve(values)).on("click"+namespace,getCssSelector(css.paginationButton),function(e){e.stopPropagation();e.preventDefault();var $this=$(this),parent=$this.parent();if(!parent.hasClass("active")&&!parent.hasClass("disabled")){var commandList={first:1,prev:that.current-1,next:that.current+1,last:that.totalPages};var command=$this.data("page");that.current=commandList[command]||command;loadData.call(that)}$this.trigger("blur")});list.append(item);return item}function renderRowCountSelection(actions){var that=this,rowCountList=this.options.rowCount;function getText(value){return(value===-1)?that.options.labels.all:value}if($.isArray(rowCountList)){var css=this.options.css,tpl=this.options.templates,dropDown=$(tpl.actionDropDown.resolve(getParams.call(this,{content:getText(this.rowCount)}))),menuSelector=getCssSelector(css.dropDownMenu),menuTextSelector=getCssSelector(css.dropDownMenuText),menuItemsSelector=getCssSelector(css.dropDownMenuItems),menuItemSelector=getCssSelector(css.dropDownItemButton);$.each(rowCountList,function(index,value){var item=$(tpl.actionDropDownItem.resolve(getParams.call(that,{text:getText(value),action:value})))._bgSelectAria(value===that.rowCount).on("click"+namespace,menuItemSelector,function(e){e.preventDefault();var $this=$(this),newRowCount=$this.data("action");if(newRowCount!==that.rowCount){that.current=1;that.rowCount=newRowCount;$this.parents(menuItemsSelector).children().each(function(){var $item=$(this),currentRowCount=$item.find(menuItemSelector).data("action");$item._bgSelectAria(currentRowCount===newRowCount)});$this.parents(menuSelector).find(menuTextSelector).text(getText(newRowCount));loadData.call(that)}});dropDown.find(menuItemsSelector).append(item)});actions.append(dropDown)}}function renderRows(rows){if(rows.length>0){var that=this,css=this.options.css,tpl=this.options.templates,tbody=this.element.children("tbody").first(),allRowsSelected=true,html="";$.each(rows,function(index,row){var cells="",rowAttr=" data-row-id=\""+((that.identifier==null)?index:row[that.identifier])+"\"",rowCss="";if(that.selection){var selected=($.inArray(row[that.identifier],that.selectedRows)!==-1),selectBox=tpl.select.resolve(getParams.call(that,{type:"checkbox",value:row[that.identifier],checked:selected}));cells+=tpl.cell.resolve(getParams.call(that,{content:selectBox,css:css.selectCell}));allRowsSelected=(allRowsSelected&&selected);if(selected){rowCss+=css.selected;rowAttr+=" aria-selected=\"true\""}}var status=row.status!=null&&that.options.statusMapping[row.status];if(status){rowCss+=status}$.each(that.columns,function(j,column){if(column.visible){var value=($.isFunction(column.formatter))?column.formatter.call(that,column,row):column.converter.to(row[column.id]),cssClass=(column.cssClass.length>0)?" "+column.cssClass:"";cells+=tpl.cell.resolve(getParams.call(that,{content:(value==null||value==="")?"&nbsp;":value,css:((column.align==="right")?css.right:(column.align==="center")?css.center:css.left)+cssClass,style:(column.width==null)?"":"width:"+column.width+";"}))}});if(rowCss.length>0){rowAttr+=" class=\""+rowCss+"\""}html+=tpl.row.resolve(getParams.call(that,{attr:rowAttr,cells:cells}))});that.element.find("thead "+getCssSelector(that.options.css.selectBox)).prop("checked",allRowsSelected);tbody.html(html);registerRowEvents.call(this,tbody)}else{renderNoResultsRow.call(this)}}function registerRowEvents(tbody){var that=this,selectBoxSelector=getCssSelector(this.options.css.selectBox);if(this.selection){tbody.off("click"+namespace,selectBoxSelector).on("click"+namespace,selectBoxSelector,function(e){e.stopPropagation();var $this=$(this),id=that.converter.from($this.val());if($this.prop("checked")){that.select([id])}else{that.deselect([id])}})}tbody.off("click"+namespace,"> tr").on("click"+namespace,"> tr",function(e){e.stopPropagation();var $this=$(this),id=(that.identifier==null)?$this.data("row-id"):that.converter.from($this.data("row-id")+""),row=(that.identifier==null)?that.currentRows[id]:that.currentRows.first(function(item){return item[that.identifier]===id});if(that.selection&&that.options.rowSelect){if($this.hasClass(that.options.css.selected)){that.deselect([id])}else{that.select([id])}}that.element.trigger("click"+namespace,[that.columns,row])})}function renderSearchField(){if(this.options.navigation!==0){var css=this.options.css,selector=getCssSelector(css.search),searchItems=findFooterAndHeaderItems.call(this,selector);if(searchItems.length>0){var that=this,tpl=this.options.templates,timer=null,currentValue="",searchFieldSelector=getCssSelector(css.searchField),search=$(tpl.search.resolve(getParams.call(this))),searchField=(search.is(searchFieldSelector))?search:search.find(searchFieldSelector);searchField.on("keyup"+namespace,function(e){e.stopPropagation();var newValue=$(this).val();if(currentValue!==newValue||(e.which===13&&newValue!=="")){currentValue=newValue;if(e.which===13||newValue.length===0||newValue.length>=that.options.searchSettings.characters){window.clearTimeout(timer);timer=window.setTimeout(function(){executeSearch.call(that,newValue)},that.options.searchSettings.delay)}}});replacePlaceHolder.call(this,searchItems,search)}}}function executeSearch(phrase){if(this.searchPhrase!==phrase){this.current=1;this.searchPhrase=phrase;loadData.call(this)}}function renderTableHeader(){var that=this,headerRow=this.element.find("thead > tr"),css=this.options.css,tpl=this.options.templates,html="",sorting=this.options.sorting;if(this.selection){var selectBox=(this.options.multiSelect)?tpl.select.resolve(getParams.call(that,{type:"checkbox",value:"all"})):"";html+=tpl.rawHeaderCell.resolve(getParams.call(that,{content:selectBox,css:css.selectCell}))}$.each(this.columns,function(index,column){if(column.visible){var sortOrder=that.sortDictionary[column.id],iconCss=((sorting&&sortOrder&&sortOrder==="asc")?css.iconUp:(sorting&&sortOrder&&sortOrder==="desc")?css.iconDown:""),icon=tpl.icon.resolve(getParams.call(that,{iconCss:iconCss})),align=column.headerAlign,cssClass=(column.headerCssClass.length>0)?" "+column.headerCssClass:"";html+=tpl.headerCell.resolve(getParams.call(that,{column:column,icon:icon,sortable:sorting&&column.sortable&&css.sortable||"",css:((align==="right")?css.right:(align==="center")?css.center:css.left)+cssClass,style:(column.width==null)?"":"width:"+column.width+";"}))}});headerRow.html(html);if(sorting){var sortingSelector=getCssSelector(css.sortable);headerRow.off("click"+namespace,sortingSelector).on("click"+namespace,sortingSelector,function(e){e.preventDefault();setTableHeaderSortDirection.call(that,$(this));sortRows.call(that);loadData.call(that)})}if(this.selection&&this.options.multiSelect){var selectBoxSelector=getCssSelector(css.selectBox);headerRow.off("click"+namespace,selectBoxSelector).on("click"+namespace,selectBoxSelector,function(e){e.stopPropagation();if($(this).prop("checked")){that.select()}else{that.deselect()}})}}function setTableHeaderSortDirection(element){var css=this.options.css,iconSelector=getCssSelector(css.icon),columnId=element.data("column-id")||element.parents("th").first().data("column-id"),sortOrder=this.sortDictionary[columnId],icon=element.find(iconSelector);if(!this.options.multiSort){element.parents("tr").first().find(iconSelector).removeClass(css.iconDown+" "+css.iconUp);this.sortDictionary={}}if(sortOrder&&sortOrder==="asc"){this.sortDictionary[columnId]="desc";icon.removeClass(css.iconUp).addClass(css.iconDown)}else if(sortOrder&&sortOrder==="desc"){if(this.options.multiSort){var newSort={};for(var key in this.sortDictionary){if(key!==columnId){newSort[key]=this.sortDictionary[key]}}this.sortDictionary=newSort;icon.removeClass(css.iconDown)}else{this.sortDictionary[columnId]="asc";icon.removeClass(css.iconDown).addClass(css.iconUp)}}else{this.sortDictionary[columnId]="asc";icon.addClass(css.iconUp)}}function replacePlaceHolder(placeholder,element){placeholder.each(function(index,item){$(item).before(element.clone(true)).remove()})}function showLoading(){var that=this;window.setTimeout(function(){if(that.element._bgAria("busy")==="true"){var tpl=that.options.templates,thead=that.element.children("thead").first(),tbody=that.element.children("tbody").first(),firstCell=tbody.find("tr > td").first(),padding=(that.element.height()-thead.height())-(firstCell.height()+20),count=that.columns.where(isVisible).length;if(that.selection){count=count+1}tbody.html(tpl.loading.resolve(getParams.call(that,{columns:count})));if(that.rowCount!==-1&&padding>0){tbody.find("tr > td").css("padding","20px 0 "+padding+"px")}}},250)}function sortRows(){var sortArray=[];function sort(x,y,current){current=current||0;var next=current+1,item=sortArray[current];function sortOrder(value){return(item.order==="asc")?value:value*-1}return(x[item.id]>y[item.id])?sortOrder(1):(x[item.id]<y[item.id])?sortOrder(-1):(sortArray.length>next)?sort(x,y,next):0}if(!this.options.ajax){var that=this;for(var key in this.sortDictionary){if(this.options.multiSort||sortArray.length===0){sortArray.push({id:key,order:this.sortDictionary[key]})}}if(sortArray.length>0){this.rows.sort(sort)}}}var Grid=function(element,options){this.element=$(element);this.origin=this.element.clone();this.options=$.extend(true,{},Grid.defaults,this.element.data(),options);var rowCount=this.options.rowCount=this.element.data().rowCount||options.rowCount||this.options.rowCount;this.columns=[];this.current=1;this.currentRows=[];this.identifier=null;this.selection=false;this.converter=null;this.rowCount=($.isArray(rowCount))?rowCount[0]:rowCount;this.rows=[];this.searchPhrase="";this.selectedRows=[];this.sortDictionary={};this.total=0;this.totalPages=0;this.cachedParams={lbl:this.options.labels,css:this.options.css,ctx:{}};this.header=null;this.footer=null;this.xqr=null};Grid.defaults={navigation:3,padding:2,columnSelection:true,rowCount:[10,25,50,-1],selection:false,multiSelect:false,rowSelect:false,keepSelection:false,highlightRows:false,sorting:true,multiSort:false,searchSettings:{delay:250,characters:1},ajax:false,ajaxSettings:{method:"POST"},post:{},url:"",caseSensitive:true,requestHandler:function(request){return request},responseHandler:function(response){return response},converters:{numeric:{from:function(value){return+value},to:function(value){return value+""}},string:{from:function(value){return value},to:function(value){return value}}},css:{actions:"actions btn-group",center:"text-center",columnHeaderAnchor:"column-header-anchor",columnHeaderText:"text",dropDownItem:"dropdown-item",dropDownItemButton:"dropdown-item-button",dropDownItemCheckbox:"dropdown-item-checkbox",dropDownMenu:"dropdown btn-group",dropDownMenuItems:"dropdown-menu pull-right",dropDownMenuText:"dropdown-text",footer:"bootgrid-footer container-fluid",header:"bootgrid-header container-fluid",icon:"icon glyphicon",iconColumns:"glyphicon-th-list",iconDown:"glyphicon-chevron-down",iconRefresh:"glyphicon-refresh",iconSearch:"glyphicon-search",iconUp:"glyphicon-chevron-up",infos:"infos",left:"text-left",pagination:"pagination",paginationButton:"button",responsiveTable:"table-responsive",right:"text-right",search:"search form-group",searchField:"search-field form-control",selectBox:"select-box",selectCell:"select-cell",selected:"active",sortable:"sortable",table:"bootgrid-table table"},formatters:{},labels:{all:"全部",infos:"显示第 {{ctx.start}} 条到第 {{ctx.end}} 条共 {{ctx.total}} 条",loading:"数据加载中...",noResults:"没有查询到记录!",refresh:"刷新",search:"查询"},statusMapping:{0:"success",1:"info",2:"warning",3:"danger"},templates:{actionButton:"<button class=\"btn btn-default\" type=\"button\" title=\"{{ctx.text}}\">{{ctx.content}}</button> <button class='btn btn-default' type='button' title='导出数据' onclick='exportExcel()'>导出</button>",actionDropDown:"<div class=\"{{css.dropDownMenu}}\"><button class=\"btn btn-default dropdown-toggle\" type=\"button\" data-toggle=\"dropdown\"><span class=\"{{css.dropDownMenuText}}\">{{ctx.content}}</span> <span class=\"caret\"></span></button><ul class=\"{{css.dropDownMenuItems}}\" role=\"menu\"></ul></div>",actionDropDownItem:"<li><a data-action=\"{{ctx.action}}\" class=\"{{css.dropDownItem}} {{css.dropDownItemButton}}\">{{ctx.text}}</a></li>",actionDropDownCheckboxItem:"<li><label class=\"{{css.dropDownItem}}\"><input name=\"{{ctx.name}}\" type=\"checkbox\" value=\"1\" class=\"{{css.dropDownItemCheckbox}}\" {{ctx.checked}} /> {{ctx.label}}</label></li>",actions:"<div class=\"{{css.actions}}\"></div>",body:"<tbody></tbody>",cell:"<td class=\"{{ctx.css}}\" style=\"{{ctx.style}}\">{{ctx.content}}</td>",footer:"<div id=\"{{ctx.id}}\" class=\"{{css.footer}}\"><div class=\"row\"><div class=\"col-sm-6\"><p class=\"{{css.pagination}}\"></p></div><div class=\"col-sm-6 infoBar\"><p class=\"{{css.infos}}\"></p></div></div></div>",header:"<div id=\"{{ctx.id}}\" class=\"{{css.header}}\"><div class=\"row\"><div class=\"col-sm-12 actionBar\"><p class=\"{{css.search}}\"></p><p class=\"{{css.actions}}\"></p></div></div></div>",headerCell:"<th data-column-id=\"{{ctx.column.id}}\" class=\"{{ctx.css}}\" style=\"{{ctx.style}}\"><a href=\"javascript:void(0);\" class=\"{{css.columnHeaderAnchor}} {{ctx.sortable}}\"><span class=\"{{css.columnHeaderText}}\">{{ctx.column.text}}</span>{{ctx.icon}}</a></th>",icon:"<span class=\"{{css.icon}} {{ctx.iconCss}}\"></span>",infos:"<div class=\"{{css.infos}}\">{{lbl.infos}}</div>",loading:"<tr><td colspan=\"{{ctx.columns}}\" class=\"loading\">{{lbl.loading}}</td></tr>",noResults:"<tr><td colspan=\"{{ctx.columns}}\" class=\"no-results\">{{lbl.noResults}}</td></tr>",pagination:"<ul class=\"{{css.pagination}}\"></ul>",paginationItem:"<li class=\"{{ctx.css}}\"><a data-page=\"{{ctx.page}}\" class=\"{{css.paginationButton}}\">{{ctx.text}}</a></li>",rawHeaderCell:"<th class=\"{{ctx.css}}\">{{ctx.content}}</th>",row:"<tr{{ctx.attr}}>{{ctx.cells}}</tr>",search:"<div class=\"{{css.search}}\"><div class=\"input-group\"><span class=\"{{css.icon}} input-group-addon {{css.iconSearch}}\"></span> <input type=\"text\" class=\"{{css.searchField}}\" placeholder=\"{{lbl.search}}\" /></div></div>",select:"<input name=\"select\" type=\"{{ctx.type}}\" class=\"{{css.selectBox}}\" value=\"{{ctx.value}}\" {{ctx.checked}} />"}};Grid.prototype.append=function(rows){if(this.options.ajax){}else{var appendedRows=[];for(var i=0;i<rows.length;i++){if(appendRow.call(this,rows[i])){appendedRows.push(rows[i])}}sortRows.call(this);highlightAppendedRows.call(this,appendedRows);loadData.call(this);this.element.trigger("appended"+namespace,[appendedRows])}return this};Grid.prototype.clear=function(){if(this.options.ajax){}else{var removedRows=$.extend([],this.rows);this.rows=[];this.current=1;this.total=0;loadData.call(this);this.element.trigger("cleared"+namespace,[removedRows])}return this};Grid.prototype.destroy=function(){$(window).off(namespace);if(this.options.navigation&1){this.header.remove()}if(this.options.navigation&2){this.footer.remove()}this.element.before(this.origin).remove();return this};Grid.prototype.reload=function(){this.current=1;loadData.call(this);return this};Grid.prototype.remove=function(rowIds){if(this.identifier!=null){var that=this;if(this.options.ajax){}else{rowIds=rowIds||this.selectedRows;var id,removedRows=[];for(var i=0;i<rowIds.length;i++){id=rowIds[i];for(var j=0;j<this.rows.length;j++){if(this.rows[j][this.identifier]===id){removedRows.push(this.rows[j]);this.rows.splice(j,1);break}}}this.current=1;loadData.call(this);this.element.trigger("removed"+namespace,[removedRows])}}return this};Grid.prototype.search=function(phrase){phrase=phrase||"";if(this.searchPhrase!==phrase){var selector=getCssSelector(this.options.css.searchField),searchFields=findFooterAndHeaderItems.call(this,selector);searchFields.val(phrase)}executeSearch.call(this,phrase);return this};Grid.prototype.select=function(rowIds){if(this.selection){rowIds=rowIds||this.currentRows.propValues(this.identifier);var id,i,selectedRows=[];while(rowIds.length>0&&!(!this.options.multiSelect&&selectedRows.length===1)){id=rowIds.pop();if($.inArray(id,this.selectedRows)===-1){for(i=0;i<this.currentRows.length;i++){if(this.currentRows[i][this.identifier]===id){selectedRows.push(this.currentRows[i]);this.selectedRows.push(id);break}}}}if(selectedRows.length>0){var selectBoxSelector=getCssSelector(this.options.css.selectBox),selectMultiSelectBox=this.selectedRows.length>=this.currentRows.length;i=0;while(!this.options.keepSelection&&selectMultiSelectBox&&i<this.currentRows.length){selectMultiSelectBox=($.inArray(this.currentRows[i++][this.identifier],this.selectedRows)!==-1)}this.element.find("thead "+selectBoxSelector).prop("checked",selectMultiSelectBox);if(!this.options.multiSelect){this.element.find("tbody > tr "+selectBoxSelector+":checked").trigger("click"+namespace)}for(i=0;i<this.selectedRows.length;i++){this.element.find("tbody > tr[data-row-id=\""+this.selectedRows[i]+"\"]").addClass(this.options.css.selected)._bgAria("selected","true").find(selectBoxSelector).prop("checked",true)}this.element.trigger("selected"+namespace,[selectedRows])}}return this};Grid.prototype.deselect=function(rowIds){if(this.selection){rowIds=rowIds||this.currentRows.propValues(this.identifier);var id,i,pos,deselectedRows=[];while(rowIds.length>0){id=rowIds.pop();pos=$.inArray(id,this.selectedRows);if(pos!==-1){for(i=0;i<this.currentRows.length;i++){if(this.currentRows[i][this.identifier]===id){deselectedRows.push(this.currentRows[i]);this.selectedRows.splice(pos,1);break}}}}if(deselectedRows.length>0){var selectBoxSelector=getCssSelector(this.options.css.selectBox);this.element.find("thead "+selectBoxSelector).prop("checked",false);for(i=0;i<deselectedRows.length;i++){this.element.find("tbody > tr[data-row-id=\""+deselectedRows[i][this.identifier]+"\"]").removeClass(this.options.css.selected)._bgAria("selected","false").find(selectBoxSelector).prop("checked",false)}this.element.trigger("deselected"+namespace,[deselectedRows])}}return this};Grid.prototype.sort=function(dictionary){var values=(dictionary)?$.extend({},dictionary):{};if(values===this.sortDictionary){return this}this.sortDictionary=values;renderTableHeader.call(this);sortRows.call(this);loadData.call(this);return this};Grid.prototype.getColumnSettings=function(){return $.merge([],this.columns)};Grid.prototype.getCurrentPage=function(){return this.current};Grid.prototype.getCurrentRows=function(){return $.merge([],this.currentRows)};Grid.prototype.getRowCount=function(){return this.rowCount};Grid.prototype.getSearchPhrase=function(){return this.searchPhrase};Grid.prototype.getSelectedRows=function(){return $.merge([],this.selectedRows)};Grid.prototype.getSortDictionary=function(){return $.extend({},this.sortDictionary)};Grid.prototype.getTotalPageCount=function(){return this.totalPages};Grid.prototype.getTotalRowCount=function(){return this.total};$.fn.extend({_bgAria:function(name,value){return(value)?this.attr("aria-"+name,value):this.attr("aria-"+name)},_bgBusyAria:function(busy){return(busy==null||busy)?this._bgAria("busy","true"):this._bgAria("busy","false")},_bgRemoveAria:function(name){return this.removeAttr("aria-"+name)},_bgEnableAria:function(enable){return(enable==null||enable)?this.removeClass("disabled")._bgAria("disabled","false"):this.addClass("disabled")._bgAria("disabled","true")},_bgEnableField:function(enable){return(enable==null||enable)?this.removeAttr("disabled"):this.attr("disabled","disable")},_bgShowAria:function(show){return(show==null||show)?this.show()._bgAria("hidden","false"):this.hide()._bgAria("hidden","true")},_bgSelectAria:function(select){return(select==null||select)?this.addClass("active")._bgAria("selected","true"):this.removeClass("active")._bgAria("selected","false")},_bgId:function(id){return(id)?this.attr("id",id):this.attr("id")}});if(!String.prototype.resolve){var formatter={"checked":function(value){if(typeof value==="boolean"){return(value)?"checked=\"checked\"":""}return value}};String.prototype.resolve=function(substitutes,prefixes){var result=this;$.each(substitutes,function(key,value){if(value!=null&&typeof value!=="function"){if(typeof value==="object"){var keys=(prefixes)?$.extend([],prefixes):[];keys.push(key);result=result.resolve(value,keys)+""}else{if(formatter&&formatter[key]&&typeof formatter[key]==="function"){value=formatter[key](value)}key=(prefixes)?prefixes.join(".")+"."+key:key;var pattern=new RegExp("\\{\\{"+key+"\\}\\}","gm");result=result.replace(pattern,(value.replace)?value.replace(/\$/gi,"&#36;"):value)}}});return result}}if(!Array.prototype.first){Array.prototype.first=function(condition){for(var i=0;i<this.length;i++){var item=this[i];if(condition(item)){return item}}return null}}if(!Array.prototype.contains){Array.prototype.contains=function(condition){for(var i=0;i<this.length;i++){var item=this[i];if(condition(item)){return true}}return false}}if(!Array.prototype.page){Array.prototype.page=function(page,size){var skip=(page-1)*size,end=skip+size;return(this.length>skip)?(this.length>end)?this.slice(skip,end):this.slice(skip):[]}}if(!Array.prototype.where){Array.prototype.where=function(condition){var result=[];for(var i=0;i<this.length;i++){var item=this[i];if(condition(item)){result.push(item)}}return result}}if(!Array.prototype.propValues){Array.prototype.propValues=function(propName){var result=[];for(var i=0;i<this.length;i++){result.push(this[i][propName])}return result}}var old=$.fn.bootgrid;$.fn.bootgrid=function(option){var args=Array.prototype.slice.call(arguments,1),returnValue=null,elements=this.each(function(index){var $this=$(this),instance=$this.data(namespace),options=typeof option==="object"&&option;if(!instance&&option==="destroy"){return}if(!instance){$this.data(namespace,(instance=new Grid(this,options)));init.call(instance)}if(typeof option==="string"){if(option.indexOf("get")===0&&index===0){returnValue=instance[option].apply(instance,args)}else if(option.indexOf("get")!==0){return instance[option].apply(instance,args)}}});return(typeof option==="string"&&option.indexOf("get")===0)?returnValue:elements};$.fn.bootgrid.Constructor=Grid;$.fn.bootgrid.noConflict=function(){$.fn.bootgrid=old;return this};$("[data-toggle=\"bootgrid\"]").bootgrid()})(jQuery,window);